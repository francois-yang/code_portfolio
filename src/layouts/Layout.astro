---
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import "../styles/global.css";
---

<!doctype html>
<html lang="fr">
    <head>
        <meta charset="UTF-8" />
        <script type="module" src="/scripts/typed-init.js"></script>
        <meta name="viewport" content="width=device-width" />
        <link rel="icon" type="image/svg+xml" href="/logo.svg" />
        <meta name="generator" content={Astro.generator} />
        <title>Mon Portfolio</title>
    </head>
    <body>
        <Header />
        <slot />
        <Footer />
    </body>
</html>

<script>
    function initScrollReveal() {
        console.log('ðŸ”„ ScrollReveal init - ' + window.location.pathname);
        
        const elements = document.querySelectorAll('[data-scroll-reveal]');
        console.log(`âœ… ${elements.length} Ã©lÃ©ments trouvÃ©s`);
        
        if (elements.length === 0) {
            console.warn('âš ï¸ Aucun Ã©lÃ©ment [data-scroll-reveal] trouvÃ©');
            return;
        }
        
        // RÃ©initialiser tous les Ã©lÃ©ments
        elements.forEach(el => {
            el.classList.remove('revealed');
        });
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const element = entry.target as HTMLElement;
                    const delay = parseFloat(element.dataset.delay || '0');
                    
                    console.log(`ðŸ‘ï¸ Ã‰lÃ©ment visible: ${element.tagName}`);
                    
                    setTimeout(() => {
                        element.classList.add('revealed');
                        console.log(`âœ¨ Classe revealed ajoutÃ©e Ã  ${element.tagName}`);
                    }, delay * 1000);
                    
                    observer.unobserve(entry.target);
                }
            });
        }, {
            threshold: 0.1,  
            rootMargin: '0px'  
        });

        elements.forEach(el => {
            console.log(`ðŸ‘€ Observer ajoutÃ© Ã  ${el.tagName}`);
            observer.observe(el);
        });
    }


    function safeInit() {

        requestAnimationFrame(() => {
            setTimeout(() => {
                initScrollReveal();
            }, 100);
        });
    }


    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', safeInit);
    } else {
        safeInit();
    }
    
 
    document.addEventListener('astro:page-load', () => {
        console.log('ðŸš€ astro:page-load');
        safeInit();
    });
    
    document.addEventListener('astro:after-swap', () => {
        console.log('ðŸ”„ astro:after-swap');
        safeInit();
    });
</script>

<style is:global>
    html,
    body {
        margin: 0;
        width: 100%;
        height: 100%;
    }
</style>
