---
import Layout from '../../layouts/Layout.astro';
import { pb, type Projet, getImageUrl } from '../../lib/pocketbase';

// Fetch de tous les projets depuis PocketBase
let projets: Projet[] = [];
let erro = false;

try {
	projets = await pb.collection('projet').getFullList<Projet>({
		sort: '-created',
	});
} catch (e) {
	console.error('Erreur lors du chargement des projets:', e);
}
---

<Layout>
	<!-- Section Projets -->
	<section class="relative py-20 px-6 min-h-screen bg-bleu-fonce">
		<div class="relative z-10 max-w-7xl mx-auto">
			<!-- Titre de la page -->
			<div class="mb-16">
				<h1 class="text-line-blue text-5xl font-bold mb-4">Mes projets</h1>
				<p class="text-blanc text-xl">Découvrez les {projets.length} projets que j'ai réalisés</p>
			</div>

			<!-- Grille des projets -->
			<div class="grid md:grid-cols-2 gap-12">
				
				{projets.length === 0 ? (
					<div class="col-span-2 text-center py-20">
						<p class="text-blanc text-xl">Aucun projet disponible pour le moment.</p>
					</div>
				) : (
					projets.map((projet) => {
						const imgUrl = getImageUrl(projet, projet.img_hero);
						
						return (
							<article class="bg-bleu-fonce border-2 border-turquoise/30 rounded-2xl overflow-hidden hover:border-turquoise transition-all duration-300 hover:shadow-[0_0_30px_rgba(0,255,238,0.3)] group">
								<!-- Image du projet -->
								<div class="relative overflow-hidden aspect-video bg-gray-800">
									<img 
										src={imgUrl}
										alt={projet.nom_projet_hero}
										class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
									/>
								</div>
								
								<!-- Contenu -->
								<div class="p-8 space-y-4">
									<h2 class="text-turquoise text-3xl font-bold">{projet.nom_projet_hero}</h2>
									<p class="text-blanc text-lg leading-relaxed">
										{projet.info1_hero}
									</p>
									
									<!-- Bouton -->
									<div class="pt-4">
										<a 
											href={`/projet/${projet.id}`}
											class="inline-flex items-center gap-2 bg-turquoise hover:bg-turquoise/90 text-bleu-fonce font-semibold px-8 py-3 rounded-lg transition-all duration-300 shadow-lg hover:shadow-[0_0_20px_rgba(0,255,238,0.5)]"
										>
											En savoir plus
											<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
												<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
											</svg>
										</a>
									</div>
								</div>
							</article>
						);
					})
				)}

			</div>
		</div>
	</section>
</Layout>
